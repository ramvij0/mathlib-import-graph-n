<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>3D Graph Visualization</title>
  <!-- Three.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <!-- 3D Force Graph -->
  <script src="https://unpkg.com/3d-force-graph@1.74.2/dist/3d-force-graph.min.js"></script>
  <!-- Graphology -->
  <script src="https://unpkg.com/graphology/dist/graphology.umd.min.js"></script>
  <!-- Graphology GEXF Parser -->
  <script src="https://unpkg.com/graphology-gexf/browser.min.js"></script>
  <style>
    html, body {
      height: 100%; width: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
    #3d-graph {
      width: 100%;
      height: 100%;
      display: block;
    }
  </style>
</head>
<body>
  <canvas id="3d-graph"></canvas>

  <script>
    // Initialize the 3D Force Graph
    const Graph = ForceGraph3D()(document.getElementById('3d-graph'))
      .nodeAutoColorBy('group') // Optional: color nodes by a 'group' attribute
      .linkDirectionalArrowLength(3.5)
      .linkDirectionalArrowRelPos(1)
      .linkDirectionalParticles(2)
      .linkDirectionalParticleSpeed(0.005);

    // Function to convert Graphology graph to 3D Force Graph format
    function graphologyToForceGraph(graphologyGraph) {
      const nodes = [];
      const links = [];

      graphologyGraph.forEachNode((node, attr) => {
        nodes.push({ id: node, ...attr });
      });

      graphologyGraph.forEachEdge((edge, attr, source, target) => {
        links.push({ source, target, ...attr });
      });

      return { nodes, links };
    }

    // Fetch and render the GEXF file
    const docs_url = "https://leanprover-community.github.io/mathlib_docs/";
    fetch(docs_url + "import.gexf")
      .then(response => response.text())
      .then(gexf => {
        // Parse GEXF using Graphology
        const graph = graphologyGexf.parse(gexf, Graphology.Graph);

        // Convert to 3D Force Graph format
        const graphData = graphologyToForceGraph(graph);

        // Load data into 3D Force Graph
        Graph
          .graphData(graphData)
          .cameraPosition({ 
            x: 0, y: 0, z: 400 
          }); // Optional: set initial camera position
      })
      .catch(error => {
        console.error('Error loading GEXF file:', error);
      });
  </script>
</body>
</html>
